{
  "type": "object",
  "x-display": "tabs",
  "required": ["datasetMode"],
  "allOf": [{
    "title": "Jeu de données",
    "oneOf": [{
      "title": "Créer un jeu de données",
      "required": ["dataset"],
      "properties": {
        "datasetMode": { "type": "string", "const": "create", "title": "Action" },
        "dataset": {
          "type": "object",
          "required": ["title"],
          "properties": {
            "title": {"type": "string", "title": "Titre du jeu de donnée", "default": "Repertoire National des Elus"}
          }
        }
      }
    }, {
      "title": "Mettre à jour un jeu de données",
      "required": ["dataset"],
      "properties": {
        "datasetMode": { "type": "string", "const": "update" },
        "dataset": {
          "type": "object",
          "title": "Jeu de donnée existant",
          "x-fromUrl": "{context.dataFairUrl}/api/v1/datasets?q={q}&select=id,title&{context.ownerFilter}",
          "x-itemsProp": "results",
          "x-itemTitle": "title",
          "x-itemKey": "id",
          "properties": {
            "id": {"type": "string", "title": "Identifiant"},
            "title": {"type": "string", "title": "Titre"}
          }
        }
      }
    }]
  }, {
    "title": "Paramètres",
    "properties": {
      "datasetID":{
        "type": "string",
        "title": "ID dataset data.gouv.fr",
        "description": "Identifiant du jeu de données à utiliser sur le portail data.gouv.fr (ex: repertoire-national-des-associations)"
      },
      "fileMerge": {
        "title": "Sélection des jeux de données",
        "oneOf": [{
          "title": "Fusionner les fichiers dans un seul jeu de données",
          "properties": {
            "fileMerge": { "type": "string", "const": "merge" }
          }
        }, {
          "title": "Un jeu de données par fichier",
          "properties": {
            "fileMerge": { "type": "string", "const": "split" }
          }
        }, {
          "title": "Un jeu de données par fichier + fusion",
          "properties": {
            "fileMerge": { "type": "string", "const": "all" }
          }
        }]
      },
      "separator":{
        "type": "string",
        "title": "Séparateur de colonnes",
        "description": "Le séparateur de colonnes utilisé dans le fichier CSV pour les champs multivalués (ex: , ou ;)"
      },
      "clearFiles": {
        "title": "supprimer les fichiers téléchargés",
        "type": "boolean",
        "default": true
      }
    }
  }]
}
